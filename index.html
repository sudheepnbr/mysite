<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OIH Premium Designer ‚Äì v86.9.90</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root { 
    --gold: #c9a035; 
    --bg-dark: #000000;
    --panel-bg: rgba(15, 15, 15, 0.98);
    --input-fill: #e0f2fe; 
}

body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: #fff; overflow-x: hidden; touch-action: none; }

/* --- LOGIN --- */
#login-overlay { position: fixed; inset: 0; z-index: 99999; display: flex; align-items: center; justify-content: center; background: #000; }
.login-card { background: #111; padding: 40px; border-radius: 20px; border: 1px solid var(--gold); width: 300px; text-align: center; }
.login-card input { width: 100%; box-sizing: border-box; padding: 12px; margin-top: 10px; border-radius: 5px; border: none; background: var(--input-fill); font-weight: 700; }
.login-btn { width: 100%; margin-top: 15px; padding: 12px; background: var(--gold); border: none; font-weight: 800; cursor: pointer; border-radius: 5px; }

/* --- UI LAYOUT --- */
.wrap { display: none; max-width: 1240px; margin: auto; padding: 20px; grid-template-columns: 340px 1fr; gap: 25px; padding-bottom: 160px; }
.panel { background: var(--panel-bg); border-radius: 15px; padding: 20px; border: 1px solid #333; position: sticky; top: 20px; height: fit-content; }
.file-box { background: var(--input-fill); color: #000; border: 2px solid var(--gold); padding: 10px; border-radius: 8px; font-weight: 800; text-align: center; cursor: pointer; margin-bottom: 10px; }
input[type="text"] { width: 100%; padding: 10px; margin: 5px 0 15px 0; box-sizing: border-box; border-radius: 5px; border: 2px solid var(--gold); background: var(--input-fill); font-weight: 700; }
.action-row { display: flex; gap: 10px; }
.icon-btn { flex: 1; height: 45px; border-radius: 8px; border: none; cursor: pointer; font-size: 20px; color: #fff; }

canvas { width: 100%; border-radius: 10px; border: 1px solid #444; margin-bottom: 20px; background: #111; cursor: crosshair; }

/* --- ALWAYS VISIBLE PREVIEW BAR --- */
#ticker-bar { 
    position: fixed; bottom: 0; left: 0; width: 100%; 
    background: #050505; 
    border-top: 3px solid var(--gold); 
    height: 110px; 
    display: none; /* Changed to flex via JS after login */
    align-items: center; 
    z-index: 9999999 !important; 
    box-shadow: 0 -10px 40px rgba(0,0,0,0.9);
}
.ticker-label { 
    background: var(--gold); color: #000; padding: 0 15px; 
    height: 100%; display: flex; align-items: center; 
    font-weight: 900; font-size: 11px; text-align: center; width: 85px; z-index: 2;
}
.ticker-view-port { flex-grow: 1; overflow: hidden; display: flex; align-items: center; height: 100%; }
.marquee { display: flex; white-space: nowrap; animation: scroll 30s linear infinite; padding-left: 20px; }
.marquee:hover { animation-play-state: paused; }
.empty-msg { color: #444; font-weight: 800; letter-spacing: 2px; text-transform: uppercase; }

.card-thumb { 
    height: 75px; width: 120px; background: #1a1a1a; border-radius: 4px; 
    margin-right: 20px; border: 1px solid #333; overflow: hidden; 
    position: relative; flex-shrink: 0; cursor: pointer; transition: 0.2s;
}
.card-thumb:hover { border-color: #fff; transform: translateY(-5px); }
.card-thumb img { width: 100%; height: 100%; object-fit: cover; }
.card-thumb-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); color: var(--gold); font-size: 8px; text-align: center; padding: 2px 0; font-weight: 800; }

@keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

/* PRINT SETTINGS (PORTRAIT MECHANICAL FEED) */
@media print {
    @page { size: 54mm 85.6mm; margin: 0; }
    #login-overlay, .panel, #ticker-bar { display: none !important; }
    body { background: white; }
    canvas { 
        width: 85.6mm !important; height: 54mm !important; 
        transform: rotate(90deg) translate(0, -54mm); 
        transform-origin: top left; 
        page-break-after: always;
        border: none !important;
    }
}
</style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card">
        <h2 style="color:var(--gold)">OIH ACCESS</h2>
        <input type="text" id="user" placeholder="Username">
        <input type="password" id="pass" placeholder="Password">
        <button class="login-btn" onclick="tryLogin()">ENTER SYSTEM</button>
    </div>
</div>

<div class="wrap" id="app">
    <div class="panel">
        <label>Photo</label>
        <div class="file-box" onclick="document.getElementById('imgIn').click()">UPLOAD IMAGE</div>
        <input type="file" id="imgIn" style="display:none" onchange="previewImg(event)">
        
        <label>Name</label><input type="text" id="name" oninput="render()">
        <label>Designation</label><input type="text" id="job" oninput="render()">
        <label>ID Number</label><input type="text" id="idnum" oninput="render()">

        <div class="action-row">
            <button class="icon-btn" style="background:#10b981" onclick="saveCard()">üíæ SAVE</button>
            <button class="icon-btn" style="background:#3b82f6" onclick="window.print()">üñ®Ô∏è PRINT</button>
            <button class="icon-btn" id="lBtn" style="background:#333" onclick="toggleLock()">üîí</button>
        </div>
        <p style="font-size: 9px; color: #555; margin-top: 20px; text-align: center;">IDP SMART-31 PORTRAIT MODE ACTIVE</p>
    </div>

    <div>
        <canvas id="front"></canvas>
        <canvas id="back"></canvas>
    </div>
</div>

<div id="ticker-bar">
    <div class="ticker-label">LAST 10<br>CARDS</div>
    <div class="ticker-view-port">
        <div class="marquee" id="ticker-track">
            <div class="empty-msg">Waiting for first save...</div>
        </div>
    </div>
</div>

<script>
const fv = document.getElementById('front'), bv = document.getElementById('back');
const fctx = fv.getContext('2d'), bctx = bv.getContext('2d');
fv.width = bv.width = 1011; fv.height = bv.height = 638;

let assets = { f: new Image(), b: new Image(), ov: new Image(), ph: null };
assets.f.src = 'front_base.png'; assets.b.src = 'back_base.png'; assets.ov.src = 'gold_overlay.png';
assets.f.onload = assets.b.onload = assets.ov.onload = render;

let phPos = { x: 550, y: 70, w: 400, h: 500 }, ovPos = { x: 440, y: 16, w: 600, h: 638 };
let isLocked = true, phRatio = 1, active = null, mode = null, start = {};

function render() {
    fctx.clearRect(0,0,1011,638);
    fctx.drawImage(assets.f, -24, -24, 1059, 678);
    if(assets.ph) fctx.drawImage(assets.ph, phPos.x, phPos.y, phPos.w, phPos.h);
    fctx.drawImage(assets.ov, ovPos.x, ovPos.y, ovPos.w, ovPos.h);
    
    fctx.fillStyle = "#000";
    fctx.font = "800 46px Inter"; fctx.fillText(document.getElementById('name').value.toUpperCase(), 70, 465);
    fctx.font = "700 34px Inter"; fctx.fillText(document.getElementById('job').value, 70, 525);
    fctx.font = "700 30px Inter"; fctx.fillText("ID No: " + document.getElementById('idnum').value, 70, 580);

    if(!isLocked) {
        fctx.strokeStyle = "gold"; fctx.lineWidth = 3;
        fctx.strokeRect(phPos.x, phPos.y, phPos.w, phPos.h);
        fctx.strokeRect(ovPos.x, ovPos.y, ovPos.w, ovPos.h);
        fctx.fillStyle = "gold";
        fctx.fillRect(phPos.x+phPos.w-20, phPos.y+phPos.h-20, 20, 20);
        fctx.fillRect(ovPos.x+ovPos.w-20, ovPos.y+ovPos.h-20, 20, 20);
    }

    bctx.clearRect(0,0,1011,638);
    bctx.drawImage(assets.b, -24, 0, 1059, 678);
}

// History Logic
function refreshTicker() {
    const list = JSON.parse(localStorage.getItem('oih_final_history')) || [];
    const track = document.getElementById('ticker-track');
    
    if(list.length > 0) {
        const html = list.map(item => `
            <div class="card-thumb">
                <img src="${item.img}">
                <div class="card-thumb-tag">${item.id}</div>
            </div>
        `).join('');
        track.innerHTML = html + html;
        track.style.animation = "scroll 30s linear infinite";
    }
}

function saveCard() {
    render();
    const snap = document.createElement('canvas');
    snap.width = 120; snap.height = 75;
    snap.getContext('2d').drawImage(fv, 0, 0, 120, 75);
    
    let list = JSON.parse(localStorage.getItem('oih_final_history')) || [];
    list.unshift({ id: document.getElementById('idnum').value || 'ID', img: snap.toDataURL('image/jpeg', 0.5) });
    if(list.length > 10) list.pop();
    
    localStorage.setItem('oih_final_history', JSON.stringify(list));
    refreshTicker();

    const link = document.createElement('a');
    link.download = (document.getElementById('name').value || 'Card') + '.png'; 
    link.href = fv.toDataURL(); 
    link.click();
}

// Interaction
fv.onmousedown = (e) => {
    if(isLocked) return;
    const r = fv.getBoundingClientRect(), x = (e.clientX - r.left)*(1011/r.width), y = (e.clientY - r.top)*(638/r.height);
    const hit = (obj) => x > obj.x && x < obj.x+obj.w && y > obj.y && y < obj.y+obj.h;
    
    if(x > phPos.x+phPos.w-40 && y > phPos.y+phPos.h-40) { active = phPos; mode = 'sz'; }
    else if(hit(phPos)) { active = phPos; mode = 'mv'; }
    else if(x > ovPos.x+ovPos.w-40 && y > ovPos.y+ovPos.h-40) { active = ovPos; mode = 'sz'; }
    else if(hit(ovPos)) { active = ovPos; mode = 'mv'; }
    
    if(active) start = { x: x - active.x, y: y - active.y, w: active.w, h: active.h, px: x, py: y };
};

window.onmousemove = (e) => {
    if(!active) return;
    const r = fv.getBoundingClientRect(), x = (e.clientX - r.left)*(1011/r.width), y = (e.clientY - r.top)*(638/r.height);
    if(mode === 'mv') { active.x = x - start.x; active.y = y - start.y; }
    else { 
        active.w = Math.max(50, start.w + (x - start.px)); 
        if(active === phPos) active.h = active.w/phRatio;
        else active.h = Math.max(50, start.h + (y - start.py));
    }
    render();
};
window.onmouseup = () => active = null;

function toggleLock() { 
    isLocked = !isLocked; 
    document.getElementById('lBtn').classList.toggle('unlocked', !isLocked);
    document.getElementById('lBtn').innerHTML = isLocked ? "üîí" : "üîì";
    render(); 
}

function tryLogin() {
    if(document.getElementById('user').value === 'admin') {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app').style.display = 'grid';
        document.getElementById('ticker-bar').style.display = 'flex';
        refreshTicker();
    }
}

function previewImg(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
        const i = new Image();
        i.onload = () => { assets.ph = i; phRatio = i.width/i.height; phPos.h = phPos.w/phRatio; render(); };
        i.src = ev.target.result;
    };
    reader.readAsDataURL(e.target.files[0]);
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OIH ID Designer ‚Äì v87.4.0 (Smart Vault)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">

<style>
:root { 
    --gold: #c9a035; 
    --bg-dark: #000000;
    --panel-bg: rgba(20, 20, 20, 0.95);
    --input-fill: #e0f2fe; 
    --danger: #ef4444;
}

body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: #fff; overflow-x: hidden; touch-action: none; }

/* --- LOGIN SCREEN (MASTER STYLE) --- */
#login-overlay {
    position: fixed; inset: 0; z-index: 9999; display: flex; align-items: center; justify-content: center;
    background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('login_bg.png');
    background-size: cover; background-position: center;
}
.login-card {
    background: rgba(15, 15, 15, 0.98); padding: 40px; border-radius: 24px; border: 1px solid var(--gold);
    width: 380px; text-align: center; box-shadow: 0 40px 80px rgba(0,0,0,0.9); backdrop-filter: blur(20px);
}
.login-card input {
    width: 100%; box-sizing: border-box; display: block; padding: 14px; margin-top: 15px; 
    border-radius: 8px; border: 2px solid var(--gold); background: var(--input-fill); font-weight: 700; color: #000;
}
.login-btn { width: 100%; margin-top: 25px; padding: 15px; background: var(--gold); color: #000; border: none; border-radius: 10px; font-weight: 800; cursor: pointer; }

/* --- MAIN UI --- */
.wrap { display: none; max-width: 1300px; margin: auto; padding: 20px; grid-template-columns: 350px 1fr; gap: 25px; padding-bottom: 150px; }
.panel { background: var(--panel-bg); border-radius: 20px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); position: sticky; top: 20px; height: fit-content; }
.header-area { text-align: center; margin-bottom: 20px; }
.ui-logo { width: 100%; max-height: 70px; object-fit: contain; }

/* SMART SEARCH BOX */
.search-container { background: #111; border: 1px solid var(--gold); padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: inset 0 0 10px #000; }
.search-container label { color: var(--gold); font-size: 10px; font-weight: 900; letter-spacing: 1px; display: block; margin-bottom: 8px; }
#vault-search { width: 100%; padding: 10px; box-sizing: border-box; background: #000; border: 1px solid #444; color: #fff; font-weight: 800; border-radius: 6px; text-align: center; font-size: 14px; }
#vault-search:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 10px var(--gold); }

/* INPUTS */
label { font-size: 10px; font-weight: 800; margin-top: 15px; display: block; text-transform: uppercase; color: #888; }
.file-box { background: var(--input-fill); color: #000; border: 2px solid var(--gold); border-radius: 8px; margin-top: 5px; padding: 10px; font-weight: 700; cursor: pointer; text-align: center; }
input[type="text"] { width: 100%; padding: 10px; border-radius: 8px; margin-top: 5px; box-sizing: border-box; background: var(--input-fill); border: 2px solid var(--gold); font-weight: 700; }

.action-row { display: flex; gap: 10px; margin-top: 20px; }
.icon-btn { flex: 1; height: 50px; border-radius: 10px; border: none; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center; transition: 0.3s; }

canvas { width: 100%; border-radius: 14px; background: #1a1a1a; display: block; border: 1px solid #333; margin-bottom: 20px; }

/* --- TICKER & ZOOM --- */
#ticker-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: #050505; border-top: 2px solid var(--gold); height: 110px; display: none; align-items: center; z-index: 10000; }
.marquee { display: flex; animation: scroll 40s linear infinite; }
.marquee:hover { animation-play-state: paused; }
.card-thumb { height: 80px; width: 130px; background: #000; border-radius: 6px; margin: 0 12px; border: 1px solid #333; flex-shrink: 0; position: relative; cursor: pointer; }

/* HD HOVER ZOOM */
.zoom-hd {
    position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%) scale(0);
    width: 320px; height: 200px; background: #000; border: 2px solid var(--gold);
    border-radius: 12px; box-shadow: 0 20px 50px #000;
    transition: 0.2s cubic-bezier(0.18, 0.89, 0.32, 1.28); pointer-events: none; z-index: 20000; overflow: hidden;
}
.card-thumb:hover .zoom-hd { transform: translateX(-50%) scale(1); }
.zoom-hd img { width: 100%; height: 100%; object-fit: contain; }

@keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

@media print {
    #login-overlay, .panel, #ticker-bar { display: none !important; }
    .wrap { display: block !important; padding: 0; }
    #fc { page-break-after: always; width: 100% !important; border: none; }
    #bc { width: 100% !important; border: none; }
}
</style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card">
        <img src="ui_logo.png" style="width: 80px;">
        <h2 style="color:var(--gold); font-weight:800; margin-top: 20px;">OIH VAULT ACCESS</h2>
        <input type="text" id="user-input" placeholder="Admin Username">
        <input type="password" id="pass-input" placeholder="Secure Password">
        <button class="login-btn" onclick="checkLogin()">AUTHORIZE SYSTEM</button>
    </div>
</div>

<div class="wrap" id="designer-ui">
  <div class="panel">
    <div class="header-area">
        <img src="ui_logo.png" class="ui-logo">
        <h1>OIH DESIGNER</h1>
    </div>

    <div class="search-container">
        <label>LIVE VAULT SEARCH (TYPE ID)</label>
        <input type="text" id="vault-search" placeholder="Search ID No..." oninput="autoSearchVault(this.value)">
    </div>

    <label>Employee Photo</label>
    <div class="file-box" onclick="document.getElementById('photoInput').click()">UPLOAD PHOTO</div>
    <input type="file" id="photoInput" accept="image/*" style="display:none" onchange="loadPhoto(event)">
    
    <label>Full Name</label><input type="text" id="fullname" oninput="draw()">
    <label>Designation</label><input type="text" id="dg" oninput="draw()">
    <label>ID Number</label><input type="text" id="idn" oninput="draw()">

    <div class="action-row">
        <button class="icon-btn" style="background:#10b981" onclick="saveToSmartVault()" title="Save & Download">üíæ</button>
        <button class="icon-btn" style="background:#3b82f6" onclick="window.print()" title="Print Card">üñ®Ô∏è</button>
        <button class="icon-btn" style="background:#ef4444" onclick="logout()" title="Exit">üö™</button>
    </div>
    <p id="storage-status" style="font-size: 9px; color: #555; text-align: center; margin-top: 10px;">Vault Storage: Optimal</p>
  </div>

  <div>
    <canvas id="fc"></canvas>
    <canvas id="bc"></canvas>
  </div>
</div>

<div id="ticker-bar">
    <div style="background:var(--gold); color:#000; padding: 25px; height:100%; font-weight:900; z-index:10; display:flex; align-items:center;">HISTORY</div>
    <div style="flex:1; overflow:hidden;"><div class="marquee" id="ticker-track"></div></div>
</div>

<script>
const fc = document.getElementById("fc"), bc = document.getElementById("bc"),
      fn = document.getElementById("fullname"), dg = document.getElementById("dg"), idn = document.getElementById("idn");
const fctx = fc.getContext("2d"), bctx = bc.getContext("2d");
fc.width = bc.width = 1011; fc.height = bc.height = 638;

let imgs = { f: new Image(), b: new Image(), ov: new Image(), ph: null };
let photoPos = { x: 550, y: 70, w: 400, h: 500 }, photoRatio = 1;

imgs.f.src = "./front_base.png";
imgs.b.src = "./back_base.png";
imgs.ov.src = "./gold_overlay.png";
imgs.f.onload = imgs.b.onload = imgs.ov.onload = draw;

function draw() {
    fctx.clearRect(0, 0, 1011, 638);
    if(imgs.f.complete) fctx.drawImage(imgs.f, -24, -24, 1059, 678);
    if(imgs.ph) fctx.drawImage(imgs.ph, photoPos.x, photoPos.y, photoPos.w, photoPos.h);
    if(imgs.ov.complete) fctx.drawImage(imgs.ov, 440, 16, 600, 638);
    
    fctx.fillStyle = "#000";
    fctx.font = "800 46px Inter";
    fctx.fillText(fn.value.toUpperCase(), 70, 465);
    fctx.font = "700 34px Inter";
    fctx.fillText(dg.value, 70, 525);
    fctx.font = "700 30px Inter";
    fctx.fillText("ID No - " + idn.value, 70, 580);

    bctx.drawImage(imgs.b, -24, 0, 1059, 678);
}

// --- SMART VAULT LOGIC ---

function saveToSmartVault() {
    const idValue = idn.value;
    if(!idValue) return alert("Error: ID Number is required to save.");

    draw();
    const finalPNG = fc.toDataURL("image/png");

    // 1. SMART COMPRESSION: Shrink employee photo to save 3x more space
    let compressedPhoto = null;
    if (imgs.ph) {
        const tempCanvas = document.createElement('canvas');
        const tctx = tempCanvas.getContext('2d');
        tempCanvas.width = 350; // Resized for storage efficiency
        tempCanvas.height = 350 / photoRatio;
        tctx.drawImage(imgs.ph, 0, 0, tempCanvas.width, tempCanvas.height);
        compressedPhoto = tempCanvas.toDataURL("image/jpeg", 0.7); // High compression JPEG
    }

    const entry = {
        id: idValue,
        name: fn.value,
        job: dg.value,
        phRaw: compressedPhoto,
        cardThumb: finalPNG // Full preview for hover
    };

    let vault = JSON.parse(localStorage.getItem('oih_smart_vault')) || [];
    const existingIdx = vault.findIndex(item => item.id === idValue);
    
    if(existingIdx > -1) vault[existingIdx] = entry; 
    else vault.unshift(entry);

    // 2. STORAGE MONITOR & SAVE
    try {
        localStorage.setItem('oih_smart_vault', JSON.stringify(vault));
        updateTicker();
    } catch (e) {
        alert("CRITICAL: Browser Storage is FULL. Please export or delete old IDs.");
        document.getElementById('storage-status').style.color = 'red';
        document.getElementById('storage-status').innerText = 'Vault Storage: FULL';
    }

    // 3. SINGLE DOWNLOAD
    const link = document.createElement('a');
    link.download = `${fn.value || 'OIH'}_${idValue}.png`;
    link.href = finalPNG;
    link.click();
}

// --- LIVE SEARCH LOGIC ---
function autoSearchVault(query) {
    if(!query) return;
    const vault = JSON.parse(localStorage.getItem('oih_smart_vault')) || [];
    const result = vault.find(item => item.id.toLowerCase() === query.toLowerCase());

    if(result) {
        fn.value = result.name;
        dg.value = result.job;
        idn.value = result.id;
        if(result.phRaw) {
            const i = new Image();
            i.onload = () => { imgs.ph = i; photoRatio = i.width / i.height; draw(); };
            i.src = result.phRaw;
        }
        draw();
    }
}

function updateTicker() {
    const vault = JSON.parse(localStorage.getItem('oih_smart_vault')) || [];
    const track = document.getElementById('ticker-track');
    if(vault.length === 0) return;
    document.getElementById('ticker-bar').style.display = 'flex';
    
    // Create looped ticker items
    const html = vault.map(item => `
        <div class="card-thumb" onclick="autoSearchVault('${item.id}')">
            <div class="zoom-hd"><img src="${item.cardThumb}"></div>
            <img src="${item.cardThumb}">
        </div>
    `).join('');
    track.innerHTML = html + html;
}

// --- MASTER HANDLERS ---
function checkLogin() {
    if(document.getElementById('user-input').value === 'admin' && document.getElementById('pass-input').value === 'oih2026') {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('designer-ui').style.display = 'grid';
        updateTicker(); draw();
    }
}

function logout() { location.reload(); }

function loadPhoto(e) {
    const r = new FileReader();
    r.onload = ev => {
        const i = new Image();
        i.onload = () => { imgs.ph = i; photoRatio = i.width / i.height; photoPos.h = photoPos.w / photoRatio; draw(); };
        i.src = ev.target.result;
    };
    r.readAsDataURL(e.target.files[0]);
}

window.onload = () => { if(sessionStorage.getItem('oih_auth') === 'true') { checkLogin(); } };
</script>
</body>
</html>

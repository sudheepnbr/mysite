<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>OIH Premium Suite ‚Äì v87.0.5</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">

<style>
:root { 
    --gold: #c9a035; 
    --gold-glow: rgba(201, 160, 53, 0.4);
    --bg-dark: #050505;
    --panel-bg: rgba(15, 15, 15, 0.95);
}

body { 
    margin: 0; font-family: 'Inter', sans-serif; 
    background: var(--bg-dark); color: #fff; 
    overflow-x: hidden; touch-action: none;
    background-image: radial-gradient(circle at 50% 50%, #111 0%, #050505 100%);
}

/* --- LOGIN SCREEN --- */
#login-overlay { position: fixed; inset: 0; z-index: 99999; display: flex; align-items: center; justify-content: center; background: #000; }
.login-card { background: rgba(20, 20, 20, 0.9); padding: 50px; border-radius: 30px; border: 1px solid var(--gold); width: 320px; text-align: center; backdrop-filter: blur(20px); }
.login-card h2 { font-weight: 900; color: var(--gold); letter-spacing: 3px; }
.login-card input { width: 100%; box-sizing: border-box; padding: 15px; margin-top: 15px; border-radius: 10px; border: 1px solid #333; background: #111; color: #fff; font-weight: 700; }
.login-btn { width: 100%; margin-top: 25px; padding: 15px; background: var(--gold); border: none; font-weight: 800; cursor: pointer; border-radius: 10px; color: #000; }

/* --- MAIN UI --- */
.wrap { display: none; max-width: 1400px; margin: auto; padding: 40px 20px; grid-template-columns: 360px 1fr; gap: 40px; padding-bottom: 180px; }
.panel { background: var(--panel-bg); border-radius: 24px; padding: 30px; border: 1px solid #222; position: sticky; top: 20px; height: fit-content; }
.section-title { font-size: 10px; font-weight: 800; color: var(--gold); letter-spacing: 2px; text-transform: uppercase; margin-bottom: 15px; display: block; }
.input-group { margin-bottom: 20px; }
.input-group label { display: block; font-size: 10px; color: #666; font-weight: 700; margin-bottom: 5px; }
.input-group input { width: 100%; padding: 12px; box-sizing: border-box; border-radius: 8px; border: 1px solid #222; background: #000; color: #fff; font-weight: 600; }

canvas { width: 100%; border-radius: 15px; border: 1px solid #1a1a1a; margin-bottom: 30px; background: #000; cursor: crosshair; }

/* --- TICKER & PREVIEW LOGIC --- */
#ticker-bar { 
    position: fixed; bottom: 0; left: 0; width: 100%; 
    background: rgba(5, 5, 5, 0.95); backdrop-filter: blur(15px);
    border-top: 2px solid var(--gold); height: 130px; 
    display: none; align-items: center; z-index: 9999;
}
.ticker-label { background: var(--gold); color: #000; padding: 0 20px; height: 100%; display: flex; align-items: center; font-weight: 900; font-size: 12px; text-align: center; }
.marquee { display: flex; align-items: center; animation: scroll 40s linear infinite; }
.marquee:hover { animation-play-state: paused; }

.card-thumb { 
    height: 90px; width: 140px; background: #000; border-radius: 8px; 
    margin: 0 15px; border: 1px solid #333; overflow: visible; 
    position: relative; flex-shrink: 0; cursor: pointer; transition: 0.3s;
}

/* BIG PREVIEW ON HOVER */
.card-thumb:hover { border-color: var(--gold); z-index: 10000; }
.card-thumb img { width: 100%; height: 100%; object-fit: cover; border-radius: 7px; }

/* The Zoom Pop-up */
.card-thumb .zoom-view {
    position: absolute; bottom: 110px; left: 50%; transform: translateX(-50%) scale(0);
    width: 300px; height: 190px; background: #000; border: 2px solid var(--gold);
    border-radius: 15px; box-shadow: 0 20px 50px rgba(0,0,0,1);
    transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    pointer-events: none; overflow: hidden;
}
.card-thumb:hover .zoom-view { transform: translateX(-50%) scale(1); }
.zoom-view img { width: 100%; height: 100%; object-fit: contain; }

.card-thumb-tag { position: absolute; bottom: 0; width: 100%; background: rgba(0,0,0,0.8); color: var(--gold); font-size: 9px; text-align: center; padding: 3px 0; border-radius: 0 0 7px 7px; }

@keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

@media print {
    @page { size: 54mm 85.6mm; margin: 0; }
    #login-overlay, .panel, #ticker-bar { display: none !important; }
    canvas { width: 85.6mm !important; height: 54mm !important; transform: rotate(90deg) translate(0, -54mm); transform-origin: top left; }
}
</style>
</head>
<body>

<div id="login-overlay">
    <div class="login-card">
        <h2>OIH ADMIN</h2>
        <input type="text" id="user" placeholder="SYSTEM ID">
        <input type="password" id="pass" placeholder="ACCESS KEY">
        <button class="login-btn" onclick="tryLogin()">INITIALIZE</button>
    </div>
</div>

<div class="wrap" id="app">
    <div class="panel">
        <span class="section-title">Redesign Panel</span>
        <div style="background: #111; border: 1px dashed var(--gold); padding: 15px; border-radius: 10px; text-align: center; cursor: pointer; margin-bottom: 20px;" onclick="document.getElementById('imgIn').click()">CHANGE PHOTO</div>
        <input type="file" id="imgIn" style="display:none" onchange="previewImg(event)">
        
        <div class="input-group"><label>Full Name</label><input type="text" id="name" oninput="render()"></div>
        <div class="input-group"><label>Designation</label><input type="text" id="job" oninput="render()"></div>
        <div class="input-group"><label>ID Number</label><input type="text" id="idnum" oninput="render()"></div>

        <div style="display:flex; gap:10px;">
            <button onclick="saveCard()" style="flex:1; padding:15px; background:#10b981; border:none; border-radius:10px; color:#fff; font-weight:800; cursor:pointer;">üíæ SAVE</button>
            <button onclick="window.print()" style="flex:1; padding:15px; background:#3b82f6; border:none; border-radius:10px; color:#fff; font-weight:800; cursor:pointer;">üñ®Ô∏è PRINT</button>
            <button id="lBtn" onclick="toggleLock()" style="width:50px; background:#222; border:1px solid #444; color:#fff; cursor:pointer; border-radius:10px;">üîí</button>
        </div>
        <p style="font-size: 10px; color: #444; margin-top: 15px; text-align: center;">TIP: Click history cards to reload data</p>
    </div>

    <div>
        <canvas id="front"></canvas>
        <canvas id="back"></canvas>
    </div>
</div>

<div id="ticker-bar">
    <div class="ticker-label">HISTORY</div>
    <div class="marquee" id="ticker-track"></div>
</div>

<script>
const fv = document.getElementById('front'), bv = document.getElementById('back');
const fctx = fv.getContext('2d'), bctx = bv.getContext('2d');
fv.width = bv.width = 1011; fv.height = bv.height = 638;

let assets = { f: new Image(), b: new Image(), ov: new Image(), ph: null };
assets.f.src = 'front_base.png'; assets.b.src = 'back_base.png'; assets.ov.src = 'gold_overlay.png';
assets.f.onload = assets.b.onload = assets.ov.onload = render;

let phPos = { x: 550, y: 70, w: 400, h: 500 }, isLocked = true, phRatio = 1, active = null, mode = null, start = {};

function render() {
    fctx.clearRect(0,0,1011,638);
    fctx.drawImage(assets.f, -24, -24, 1059, 678);
    if(assets.ph) fctx.drawImage(assets.ph, phPos.x, phPos.y, phPos.w, phPos.h);
    fctx.drawImage(assets.ov, 440, 16, 600, 638);
    
    fctx.fillStyle = "#000";
    fctx.font = "900 46px Inter"; fctx.fillText(document.getElementById('name').value.toUpperCase(), 70, 465);
    fctx.font = "400 34px Inter"; fctx.fillText(document.getElementById('job').value, 70, 525);
    fctx.font = "700 30px Inter"; fctx.fillText("ID NO: " + document.getElementById('idnum').value, 70, 580);

    if(!isLocked) {
        fctx.strokeStyle = "gold"; fctx.lineWidth = 2;
        fctx.strokeRect(phPos.x, phPos.y, phPos.w, phPos.h);
        fctx.fillStyle = "gold"; fctx.fillRect(phPos.x+phPos.w-15, phPos.y+phPos.h-15, 15, 15);
    }
    bctx.clearRect(0,0,1011,638);
    bctx.drawImage(assets.b, -24, 0, 1059, 678);
}

// HISTORY & REDESIGN LOGIC
function refreshTicker() {
    const list = JSON.parse(localStorage.getItem('oih_pro_history')) || [];
    const track = document.getElementById('ticker-track');
    if(list.length === 0) { track.innerHTML = ""; return; }
    
    // Create items. We store Full Data so we can redesign.
    const html = list.map((item, idx) => `
        <div class="card-thumb" onclick="loadForRedesign(${idx})">
            <div class="zoom-view"><img src="${item.img}"></div>
            <img src="${item.img}">
            <div class="card-thumb-tag">${item.id}</div>
        </div>
    `).join('');
    
    track.innerHTML = html + html; // Simple double for loop
}

function loadForRedesign(idx) {
    const list = JSON.parse(localStorage.getItem('oih_pro_history')) || [];
    const data = list[idx];
    if(!data) return;
    
    document.getElementById('name').value = data.name || "";
    document.getElementById('job').value = data.job || "";
    document.getElementById('idnum').value = data.id || "";
    
    if(data.phRaw) {
        const i = new Image();
        i.onload = () => { assets.ph = i; phRatio = i.width/i.height; render(); };
        i.src = data.phRaw;
    }
    render();
}

function saveCard() {
    render();
    const snap = document.createElement('canvas'); snap.width = 140; snap.height = 90;
    snap.getContext('2d').drawImage(fv, 0, 0, 140, 90);
    
    let list = JSON.parse(localStorage.getItem('oih_pro_history')) || [];
    
    // Save full data for restoration later
    const entry = {
        id: document.getElementById('idnum').value,
        name: document.getElementById('name').value,
        job: document.getElementById('job').value,
        img: snap.toDataURL('image/jpeg', 0.6),
        phRaw: assets.ph ? assets.ph.src : null
    };
    
    list.unshift(entry);
    if(list.length > 10) list.pop();
    localStorage.setItem('oih_pro_history', JSON.stringify(list));
    refreshTicker();

    const link = document.createElement('a');
    link.download = 'OIH_'+entry.id+'.png'; link.href = fv.toDataURL(); link.click();
}

function tryLogin() {
    if(document.getElementById('user').value === 'admin') {
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('app').style.display = 'grid';
        document.getElementById('ticker-bar').style.display = 'flex';
        refreshTicker();
    }
}

function toggleLock() { isLocked = !isLocked; document.getElementById('lBtn').innerHTML = isLocked ? "üîí" : "üîì"; render(); }

fv.onmousedown = (e) => {
    if(isLocked) return;
    const r = fv.getBoundingClientRect(), x = (e.clientX - r.left)*(1011/r.width), y = (e.clientY - r.top)*(638/r.height);
    if(x > phPos.x+phPos.w-40 && y > phPos.y+phPos.h-40) { active = phPos; mode = 'sz'; }
    else if(x > phPos.x && x < phPos.x+phPos.w && y > phPos.y && y < phPos.y+phPos.h) { active = phPos; mode = 'mv'; }
    if(active) start = { x: x - active.x, y: y - active.y, w: active.w, h: active.h, px: x };
};
window.onmousemove = (e) => {
    if(!active) return;
    const r = fv.getBoundingClientRect(), x = (e.clientX - r.left)*(1011/r.width), y = (e.clientY - r.top)*(638/r.height);
    if(mode === 'mv') { active.x = x - start.x; active.y = y - start.y; }
    else { active.w = Math.max(50, start.w + (x - start.px)); active.h = active.w/phRatio; }
    render();
};
window.onmouseup = () => active = null;

function previewImg(e) {
    const reader = new FileReader();
    reader.onload = (ev) => {
        const i = new Image();
        i.onload = () => { assets.ph = i; phRatio = i.width/i.height; phPos.h = phPos.w/phRatio; render(); };
        i.src = ev.target.result;
    };
    reader.readAsDataURL(e.target.files[0]);
}
</script>
</body>
</html>
